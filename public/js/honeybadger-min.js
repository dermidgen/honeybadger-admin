/*! honeybadger-admin 2015-06-24 */
var Promise=function(a,b){this.then=function(a,b){return this.next=new Promise(a,b),this.next},this.run=function(){a.promise=this,a.apply(b)},this.complete=function(){this.next&&this.next.run()}};Promise.create=function(a){return a.hasOwnProperty("promise")?a.promise:new Promise};var Emitter=function(a){var b=[];a.on=function(c,d){b.push({event:c,context:a,callback:d})};var c=function(a,c,d){for(var e=0;e<b.length;e++)b[e].event===a&&b[e].context&&b[e].callback(c)};return function(b,d){c(b,d,a)}},Modular=function(a,b){var c={},d=[],e=function(a){return d.push(a),b()};this.init=function(){for(var a=0;a<d.length;a++)d[a]()},this.register=function(a,b){void 0!=typeof a.name&&void 0!=typeof a.instance&&(void 0==typeof c[a.name]&&(c[a.name]=a.instance),b&&b(e))}},Extend=function(a,b){var c={};for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];typeof e==Function?c[d]=function(){e.apply(c,arguments)}:c[d]=a[d]}for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c},HoneyBadger=function(a){var b,c,d,e="ws://"+location.host+"/admin/",f={},g=!1,h=window.location.host.indexOf("localhost")>-1||window.location.host.indexOf("192.168")>-1?!0:!1,i={},j={},k=new Emitter(j),l=new Modular(this,function(){return Extend(i,j)});console.log("HoneyBadger starting up");var m=function(){console.log("HoneyBadger initializing"),n(),console.log("HoneyBadger initializing submodules"),l.init(),console.log("HoneyBadger initializing complete!")},n=function(){return b&&clearInterval(b),c&&clearInterval(c),d=new WebSocket(e),d.onopen=function(){b&&clearInterval(b),c=setInterval(function(){d.send("ping")},15e3),k("readyStateChange",1)},d.onclose=function(){c&&clearInterval(c),b=setInterval(n,1e3)},d.onmessage=p,d},o=function(a,b,c){var b=b||[],e=c?((new Date).getTime()*Math.random(1e3)).toString(36):null;e&&(f[e]=c),h&&g&&(console.trace(),console.dir({method:a,msig:e,args:b})),d.send(JSON.stringify({method:a,msig:e,args:b}))},p=function(a){if("pong"!==a.data){h&&g&&console.dir(a);var b=JSON.parse(a.data),c=b.msig||null;return c&&f[c]?(f[c](b),void delete f[c]):void("log-stream"==b.event&&k("log-stream",b))}};return i.init=m,i.module={register:l.register},j.__devmode=h,j.__logverbose=g,j.exec=function(a,b,c){o(a,b,c)},i}(HoneyBadger||{});+function(a){var b=this,c=[],d=[],e=[],f=[],g=[],h=function(){console.log("DataManager constructor"),a.on("readyStateChange",function(a){1===a&&(j("ready",!0),b.refresh())})},i=function(){console.log("DataManager initialized")};a.module.register({name:"DataManager",instance:this},function(b){a=b(i),h()});var j=new Emitter(this);HoneyBadger.DataManager=this,this.loadSources=function(d){var e=Promise.create(b.loadSources);return a.exec("source.list",null,function(a){a.err||(c=a.body),d&&d(a),j("sources",c),e.complete()}),e},this.loadExtractors=function(c){var e=Promise.create(b.loadExtractors);return a.exec("extractor.list",null,function(a){a.err||(d=a.body),c&&c(a),j("extractors",d),e.complete()}),e},this.loadTransformers=function(c){var d=Promise.create(b.loadTransformers);return a.exec("transformer.list",null,function(a){a.err||(e=a.body),c&&c(a),j("transformers",e),d.complete()}),d},this.loadLoaders=function(c){var d=Promise.create(b.loadLoaders);return a.exec("loader.list",null,function(a){a.err||(f=a.body),c&&c(a),j("loaders",f),d.complete()}),d},this.loadTasks=function(c){var d=Promise.create(b.loadTasks);return a.exec("task.list",null,function(a){a.err||(g=a.body),c&&c(a),j("tasks",g),d.complete()}),d},this.refresh=function(a){this.loadSources().then(this.loadExtractors).then(this.loadTransformers).then(this.loadLoaders).then(this.loadTasks).then(function(){a&&a(),j("refresh",{sources:c,extractors:d,transformers:e,loaders:f,tasks:g})})},this.getSources=function(){return c},this.getExtractors=function(){return d},this.getTransformers=function(){return e},this.getLoaders=function(){return f},this.getTasks=function(){return g},this.getSource=function(a){return b.getSources().filter(function(b){return b.id==a?b:null}).pop()},this.getExtractor=function(a){return b.getExtractors().filter(function(b){return b.id==a?b:null}).pop()},this.getTransformer=function(a){return b.getTransformers().filter(function(b){return b.id==a?b:null}).pop()},this.getLoader=function(a){return b.getLoaders().filter(function(b){return b.id==a?b:null}).pop()},this.getTask=function(a){return b.getTasks().filter(function(b){return b.id==a?b:null}).pop()},this.source=function(a,b,c){},this.validateSource=function(b,c){a.exec("source.test",[b],c)},this.saveSource=function(b,c){a.exec("source.save",[b],c)},this.extractor={},this.extractor.validate=function(){},this.extractor.save=function(b,c){a.exec("extractor.save",[b],c)},this.extractor.sample=function(b,c){a.exec("extractor.test",[b],c)},this.transformer={},this.transformer.validate=function(a,b){},this.transformer.save=function(b,c){a.exec("transformer.save",[b],c)},this.transformer.sample=function(b,c){a.exec("transformer.test",[b],c)},this.loader={},this.loader.validate=function(b,c){a.exec("loader.validate",[b],c)},this.loader.validateConnection=function(b,c){a.exec("loader.validateConnection",[b],c)},this.loader.createSchema=function(b,c){a.exec("loader.createSchema",[b],c)},this.loader.save=function(b,c){a.exec("loader.save",[b],c)},this.loader.sample=function(b,c){a.exec("loader.test",[b],c)},this.task={},this.task.save=function(b,c){a.exec("task.save",[b],c)},this.task.sample=function(b,c){a.exec("task.test",[b],c)},this.task.run=function(b,c){a.exec("task.run",[b],c)},this.ftpBrowse=function(b,c,d){a.exec("ftp.browse",[b,c],d)},this.retsExplore=function(b,c){a.exec("rets.getMetadataResources",[b],c)},this.retsBrowse=function(b,c){a.exec("rets.getClassifications",[b],c)},this.retsInspect=function(b,c){a.exec("rets.getMetadataTable",[b],c)}}(HoneyBadger||{}),+function(a){return a.source=function(a){return{create:function(){},read:function(){},update:function(){},"delete":function(){}}},a}(HoneyBadger||{});